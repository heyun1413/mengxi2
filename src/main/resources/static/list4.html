
<table class="layui-hide" id="table" lay-filter="table"></table>

<script type="text/html" id="indexTpl">
    {{d.LAY_TABLE_INDEX+1}}
</script>
<script type="text/html" id="operations">
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<script>

    function loadPage($, modelUri) {
        $.ajax({
            url: '/form.html?modelUri=' + modelUri,
            success: function (res) {
                $('.layui-body').html(res);
            }
        });
    }
    var modelUri;
    layui.use(['element', 'layer', 'table'], function () {
        var layer = layui.layer,
            table = layui.table; //弹层,
        /**
         * 通过数据获取显示的列
         * @param result
         * @returns [] columns
         */
        function getColumns(result) {
            var columns = [
                {type: 'checkbox', fixed: 'left'},
                {title: '序号', templet: '#indexTpl', width:80}
            ];
            for (var i = 0; i < result.items.length; i++) {
                var item = result.items[i];
                columns.push({
                    field: item.path,
                    hide: false,
                    sort: false,
                    title: item.title
                });
            }
            columns.push({fixed: 'right', width: 165, align:'center', toolbar: '#operations'});
            return columns;
        }
        console.log(location.href);
        modelUri = '/private/videoMonitor';
        layui.jquery.getJSON(modelUri + '/table', function (result) {
            table.render({
                elem: '#table',
                url: modelUri + '/data/lay-ui',
                parseData: function(res){ //res 即为原始返回的数据
                    return {
                        "code": res.code, //解析接口状态
                        "msg": res.msg, //解析提示文本
                        "count": res.data.count, //解析数据长度
                        "data": res.data.data //解析数据列表
                    };
                },
                title: result.title,
                page: true, //开启分页
                toolbar: 'default', //开启工具栏，此处显示默认图标，可以自定义模板，详见文档
                cols: [getColumns(result)]
            });
        });

        if (!router) {
            throw new Error("初始化异常");
        }
        router.route(modelUri + '/form', function () {
            loadPage(layui.jquery, modelUri);
        });

        //监听头工具栏事件
        table.on('toolbar(table)', function (obj) {
            var checkStatus = table.checkStatus(obj.config.id)
                , data = checkStatus.data; //获取选中的数据
            switch (obj.event) {
                case 'add':
                    router.updateView(modelUri + '/form');
                    break;
                case 'update':
                    if (data.length === 0) {
                        layer.msg('请选择一行');
                    } else if (data.length > 1) {
                        layer.msg('只能同时编辑一个');
                    } else {
                        layer.alert('编辑 [id]：' + checkStatus.data[0].id);
                    }
                    break;
                case 'delete':
                    if (data.length === 0) {
                        layer.msg('请选择一行');
                    } else {
                        layer.msg('删除');
                    }
                    break;
            };
        });

        //监听行工具事件
        table.on('tool(table)', function (obj) { //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
            var data = obj.data //获得当前行数据
                , layEvent = obj.event; //获得 lay-event 对应的值
            if (layEvent === 'detail') {
                layer.msg('查看操作');
            } else if (layEvent === 'del') {
                layer.confirm('真的删除行么', function (index) {
                    obj.del(); //删除对应行（tr）的DOM结构
                    layer.close(index);
                    //向服务端发送删除指令
                });
            } else if (layEvent === 'edit') {
                layer.msg('编辑操作');
            }
        });
    });
</script>

